// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          String    @default("player") // "player", "coach", "admin"
  createdAt     DateTime  @default(now())
  accounts      Account[]
  sessions      Session[]
  coaches       Coach[]
  bookings      Booking[]
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Club {
  id           String        @id @default(uuid())
  name         String
  location     String
  contactInfo  String?
  openingHours String?
  logo         String?
  createdAt    DateTime      @default(now())
  // Weekly schedule - stored as hour (0-23) for each day
  mondayOpen     Int?
  mondayClose    Int?
  tuesdayOpen    Int?
  tuesdayClose   Int?
  wednesdayOpen  Int?
  wednesdayClose Int?
  thursdayOpen   Int?
  thursdayClose  Int?
  fridayOpen     Int?
  fridayClose    Int?
  saturdayOpen   Int?
  saturdayClose  Int?
  sundayOpen     Int?
  sundayClose    Int?
  courts       Court[]
  coaches      Coach[]
  pricingRules PricingRule[]
  specialHours ClubSpecialHours[]
}

model ClubSpecialHours {
  id        String   @id @default(uuid())
  club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  clubId    String
  date      DateTime @db.Date
  openTime  Int      // Hour of opening (0-23)
  closeTime Int      // Hour of closing (0-23)
  createdAt DateTime @default(now())

  @@unique([clubId, date])
}

model Court {
  id                String        @id @default(uuid())
  clubId            String
  name              String
  slug              String?       @unique
  type              String?
  surface           String?
  indoor            Boolean       @default(false)
  defaultPriceCents Int           @default(0)
  courtOpenTime     Int?          // Optional: hour when court opens (0-23)
  courtCloseTime    Int?          // Optional: hour when court closes (0-23)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  club         Club          @relation(fields: [clubId], references: [id])
  bookings     Booking[]
  pricingRules PricingRule[]
}

model Coach {
  id             String              @id @default(uuid())
  user           User                @relation(fields: [userId], references: [id])
  userId         String
  club           Club                @relation(fields: [clubId], references: [id])
  clubId         String
  bio            String?
  availabilities CoachAvailability[]
  createdAt      DateTime            @default(now())
  bookings       Booking[]
}

model CoachAvailability {
  id        String   @id @default(uuid())
  coach     Coach    @relation(fields: [coachId], references: [id])
  coachId   String
  start     DateTime
  end       DateTime
  createdAt DateTime @default(now())
}

model Booking {
  id        String    @id @default(uuid())
  court     Court     @relation(fields: [courtId], references: [id])
  courtId   String
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  coach     Coach?    @relation(fields: [coachId], references: [id])
  coachId   String?
  start     DateTime
  end       DateTime
  price     Int
  status    String // "pending", "paid", "cancelled"
  paymentId String?
  createdAt DateTime  @default(now())
  payments  Payment[]
}

model Payment {
  id        String   @id @default(uuid())
  booking   Booking  @relation(fields: [bookingId], references: [id])
  bookingId String
  provider  String
  status    String
  amount    Int
  createdAt DateTime @default(now())
}

model PricingRule {
  id        String   @id @default(uuid())
  club      Club     @relation(fields: [clubId], references: [id])
  clubId    String
  court     Court?   @relation(fields: [courtId], references: [id])
  courtId   String?
  startTime Int
  endTime   Int
  price     Int
  createdAt DateTime @default(now())
}
